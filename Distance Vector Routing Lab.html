<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta content="en-us" http-equiv="Content-Language" />
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>Distance Vector Routing Lab</title>
<style type="text/css">
.NormalText {
	margin: 30px;
	font-family: Arial, Helvetica, sans-serif;
	line-height: 150%;
	text-align: justify;
}
.SectionTitles {
	font-family: Arial, Helvetica, sans-serif;
	font-size: x-large;
}
.SubSectionTitles {
	font-family: Arial, Helvetica, sans-serif;
	font-size: large;
}
.FigureCap {
	font-family: Arial, Helvetica, sans-serif;
	text-align: center;
	height: 20mm;
}
.NewMaterial {
	background-color: #CCCCCC;
}
.RemovedText {
	text-decoration: line-through;
}
.FigureTable {
	width:100%;
	text-align:center;
}
.CodeStyle {
	font-family: "Courier New", Courier, monospace;
	font-style: normal;
}
.NotesStyle {
	width: 70%;
	margin: auto;
	text-align: justify;
}
</style>
<base target="_blank" />

</head>

<body lang="en-us" class="NormalText" style="text-align: center;background-color: #CCCCCC">
<div style="max-width: 900px; padding: 50px; display: inline-block; text-align: left; background-color: #FFFFFF">

<table style="width: 100%">
	<tr>
		<td style="text-align: center">
		<h1>Distance Vector Routing</h1>
		</td>
	</tr>
	<tr>
		<td style="text-align:center"><em>By Farrokh Ghani Zadegan,
             	<a href="http://www.ida.liu.se/~nikca/">Niklas Carlsson</a>
		and Carl Magnus Bruhner.<br />
		Based on an assignment by Juha Takkinen and originally J.F.
                Kurose and K.W. Ross.<br />
                Last updated January 2021.</em></td>
	</tr>
</table>

<p class="SectionTitles">Contents</p>
<ul>
	<li><a href="#Overview_of_the_Assignment" target="_self">Overview of the Assignment</a></li>
	<li><a href="#Preliminaries" target="_self">Preliminaries</a></li>
	<li><a href="#What_You_Should_Implement" target="_self">What You Should Implement</a></li>
	<li><a href="#Execution_of_the_Simulator" target="_self">Execution of the Simulator</a></li>
	<li><a href="#Other" target="_self">Link Costs and Events</a></li>
	<li><a href="#Development_Strategy" target="_self">Development Strategy</a></li>
	<li><a href="#Supplementary_questions_on_the_labs" target="_self">Beyond Poisoned Reverse </a></li>
	<li><a href="#Reporting" target="_self">Reporting</a></li>
</ul>

<p class="SectionTitles"><a name="Overview_of_the_Assignment">Overview of the Assignment</a></p>
<p>
In this assignment, you will work with a simulation of a distributed and
asynchronous distance vector routing protocol, based on the Bellman-Ford
equation. Your job is to implement a the router node logic, and for this you
should (i) design, (ii) implement, (iii) test and (iv) demonstrate a solution.
The solution should include the &quot;Poisoned Reverse&quot; technique, which
solves the problem of looping in routing topologies. Finally, you should write
a lab report according to the instructions.
</p>

<div style="background-color:yellow; border:dotted; padding: 10px; margin: 50px">
<p><strong>Important note:</strong>
The Python version of the lab is new for this year (2021), and there are
possibly some un-caught bugs still dwelling in the code. If you happen to
stumble upon any such bug, please send me an email (carbr307 @ stud..) and/or
inform your laboration assistant so that it can be fixed. The same goes for the
Java version, as I've made a few changes to it this year as well. Thanks!
<em>/Carl Magnus</em></p>
</div>

<p>&nbsp;</p>
<hr noshade="noshade" size="1" width="33%" />
<br />
<p class="SectionTitles"><a name="Preliminaries">Preliminaries</a></p>

Before starting to do the coding for this assignment, you need to:
<ul>
	<li><em>carefully read and fully understand how the Distance-Vector
	Routing Algorithm is implemented and works. (See the course textbook;
	i.e., <strong>Computer Networking: A Top-Down Approach</strong>). Also
	pay special attention to the problem of <strong>routing loops</strong>
	(a.k.a. the count-to-infinity problem) in the routing topologies, and to
	how the <strong>poisoned reverse</strong> technique solves this problem,
	</em></li>
	<li><em>
	read through this manual, and</em></li>
	<li><em>
	read the provided source codes to understand how communication takes
	place between nodes.</em></li>
</ul>

Ignoring the above "important note" (and advice) typically results in many extra hours in the lab.
You should REALLY understand how distance vector routing works before you making changes to the code.
Carefully writing down the algorithms and tracing through some example scenarios may also help here.

<p>&nbsp;</p>
<hr noshade="noshade" size="1" width="33%" />
<br />
<p class="SectionTitles"><a name="What_You_Should_Implement">What You Should Implement</a></p>

<p>
The main challenge in this assignment is that your code must be asynchronous. For this assignment
you will use an event-driven simulator that manages communication between routers. You should
implement the part of the algorithm which is executed in each router. Although routers are
active in the same program (simulator), they can only communicate with each other by sending
messages through the simulator.
</p>
<p>For this assignment you will use the following files (which is either
downloaded for <a href="dvr-java.zip">Java</a> or
<a href="dvr-python.zip">Python</a>):</p>
<ul>
	<li>RouterNode</li>
	<li>RouterSimulator</li>
	<li>RouterPacket</li>
	<li>GuiTextArea</li>
	<li>F</li>
	<li>Makefile <em>(Java only)</em></li>
</ul>
<p>The simulator has three preconfigured simulations that can be used to test
your code, with 3, 4 and 5 nodes (<a href="#Fig1" target="_self">Figure 1</a>).
</p>

<table  class="FigureTable">
	<tr><a name="Fig1">
		<td valign="middle"><img src="images/3_node.png" style="width:90%;text-align:center" /></td>
		<td valign="middle"><img src="images/4_node.png" style="width:90%;text-align:center" /></td>
		<td valign="middle"><img src="images/5_node.png" style="width:90%;text-align:center" /></td>
	</tr></a>
	<tr>
		<td colspan="3" class="FigureCap"><strong>Figure 1:</strong>
		Predefined networks with 3, 4 and 5 nodes in RouterSimulator.
		</td>
	</tr>
</table>

<p>For this assignment, you should only add code to the
<strong>RouterNode</strong> file. For testing your implemented code (in
<strong>RouterNode</strong>), you may use command line arguments to alter the
configuration of <strong>RouterSimulator</strong>. You can use the F class in
the <strong>F</strong> file to perform simple formatted text output.</p>

<p>
You should add code for the constructor and methods in the
<span class="CodeStyle">RouterNode</span> class that is in the
<strong>RouterNode</strong> file. You may only communicate with other routers
via the <span class="CodeStyle">sendUpdate()</span> method. You should not add
any <span class="CodeStyle">static</span> member to this class, or by any means
get around the requirement that all information must go via
<span class="CodeStyle">sendUpdate()</span>. Moreover, it is not acceptable to
use specific values for link costs (such as negative numbers) to signal the
other routers to perform an operation.
</p>

<p>Other methods in the file are:</p>
<ul>
	<li><span class="CodeStyle">recvUpdate()</span> which is called by the simulator
	(executed) when a node receives an update from one of its neighbors</li>
	<li><span class="CodeStyle">updateLinkCost()</span> which is called by the
	simulator (executed) when the cost of link of a node is about to change</li>
	<li><span class="CodeStyle">printDistanceTable()</span> which is used for debugging and testing of code, and also for demonstration of
	your solution to the assignment. This method should print the distance vector table (i.e. the routing table) in a format that you and
	your lab assistant can read and understand (preferably self-explanatory, but you should be able to explain exactly what your table
	contains to your lab assistant).</li>
</ul>
<!-- Included above!
<div  class="NotesStyle">
	<table cellpadding="20">
		<tr>
			<td><em><b>Important note:</b>
                        Your tables should preferably be self-explanatory,
                        and when you demonstrate your
			code to the lab assistant, you should be able to explain exactly what
			your tables contain. </em> </td>
		</tr>
	</table>
</div>
-->

<p>&nbsp;</p>
<hr noshade="noshade" size="1" width="33%" />
<br />
<p class="SectionTitles"><a name="Execution_of_the_Simulator">Execution of the Simulator</a></p>
<p>
You start the simulator by typing (with default configuration):</p>

<div class="CodeStyle" style="margin-left:75px">% java RouterSimulator</div>

or

<div class="CodeStyle" style="margin-left:75px">% python3 RouterSimulator.py</div>



<p>
The simulator starts by initializing each router. A number of windows appear on
the screen, one for the simulator output and one for each router node that is
initialized, see <a href="#Fig2" target="_self">Figure 2</a>. The title of the
window describes what is in it. The graphical user interface is implemented in
the <strong>GuiTextArea</strong> file. In your implementation, in the window of
each of the router nodes, the minimum distance vector and route (next hop) to
take to reach each of the destinations should be displayed. Optionally, the
physical cost to each of the neighbors and the minimum distance vectors
received from neighboring nodes can also be shown.</p>


<table  class="FigureTable">
	<tr>
		<td>
		<a name="Fig2">
		<img src="images/screen.png" alt="Figure 2" style="width:100%" /></a></td>
	</tr>
	<tr>
		<td class="FigureCap"><strong>Figure 2:</strong>
		Contents of the screen when simulation starts
		</td>
	</tr>
</table>

<p>
From this starting point, your code should ensure that updates occur on the
network, i.e., since the simulator stops as soon as there are no packets being
transmitted, your code should be such that as soon as a node is initialized, it
sends updates to its neighbors. The simulator will run until the routing tables
have converged, i.e., when there are no more messages or events in the system.
</p>
<!--
<p>
You can set the trace level via the command line by <span class="CodeStyle">DTrace</span>, as you did when you started the
simulator above. A trace value of 1 or 2 means that the simulator will print details about what happens internally, such as
what happens to packets and timers. A trace value of 0 disables tracking. A value of 2 means that the simulator will show
you all possible information that can be useful for debugging your code. Such a nice tracking feature is not available in
real networks.
</p>
-->

 <!-- [Farrokh] I commented out the above paragraph since I belive the only useful value for the Trace variable is 3. When
 using 1 and 2, the printDistanceTable() method is not called by simulator, and when using 4, too much informaion (such as
  what the next scheduled event is) are displayed.-->

<p>The simulator can be configured (default in <strong>bold</strong>) with link
cost change (<strong>on</strong>/off), number of nodes (<strong>3</strong>, 4,
5), poison reverse (<strong>on</strong>/off), seed value for pseudo-random
numbers in the simulator (default: <strong>1234</strong>), and trace level for
debuging (1, 2, <strong>3</strong>, 4). At least disabling link cost change and
poison reverse, as well as trying different number of nodes, will be useful.

<p>In order to change the values, you can run the programs with command line
arguments such as these examples (disabling link cost change and poison reverse,
using 4 nodes):

<div class="CodeStyle" style="margin-left:75px">% java -DChange=false -DPoison=false -DNodes=4 RouterSimulator</div>

or

<div class="CodeStyle" style="margin-left:75px">% python3 RouterSimulator -c false -p false -n 4</div>

<!--
<p>Using another initial value for pseudo-random numbers gives a different sequence of events for the messages in your network.
</p>
-->
<!--<div class="NotesStyle">
	<table cellpadding="20">
		<tr>
			<td>-->
			<div style="background-color:#DDD;border:dotted;padding:20px;margin:50px">
			<em>Note for Java: The provided <strong>Makefile</strong> can be used to facilitate doing this
			assignment with Java. For example, entering the following command in the terminal, compiles the
			files and starts the simulation with 4 nodes and poison reverse turned off</em>:<br /><br />
			<div class="CodeStyle" style="margin-left:75px">% make test4np</div>
			<br />
			<em>You can select among the provided test configurations
			<span class="CodeStyle">test#nc</span> (no changed link costs or poison reverse),
			<span class="CodeStyle">test#np</span> (change link costs, but don't use poison reverse)
			and <span class="CodeStyle">test#p</span> (change link costs, and use poison reverse) with
			# being 3, 4 or 5 (number of nodes). This correlates with the recommended development
			steps.</em><br />
			<br />
			A useful command is <span class="CodeStyle">make clobber</span> which deletes the results of
			previous compilation. Such deletion of <span class="CodeStyle">.class</span> files ensures
			that the next <span class="CodeStyle">make test</span> uses the most recent version of the
			<span class="CodeStyle">.java</span> files.<br />
			<br />
			You can examine the <strong>Makefile</strong> and modify it according to your needs.
			</em></div>
			<!--</td>
		</tr>
	</table>
</div>-->

<p>&nbsp;</p>
<hr noshade="noshade" size="1" width="33%" />
<br />
<p class="SectionTitles"><a name="Other"></a>Link Costs and Events</p>

<p>
You should make sure that the network topology
or the link costs will <strong>not</strong> change
as a result of running your implementation of the distance vector routing. You can,
however, as you will see later in this manual, use <em>events</em> in the
RouterSimulator class to study how your algorithm responds to the changes in
link costs.</p>

<p>
When you demonstrate your solution and/or your TA tests your code,
he/she might use other values for the
link costs in the topology. You should change the values to test your
code more thoroughly only by initializing the data structure
<span class="CodeStyle">connectcosts[][]</span> in the
<span class="CodeStyle">RouterSimulator()</span>, see
<a href="#init" target="_self">Figure 3</a>. However, make sure to
put the same link costs in both directions on each link,
as this assignment only considers symmetric link costs. It is also here that
different topologies can be encoded.
You can also experiment with new topologies by
changing the number of nodes (if required) and initializing the
<span class="CodeStyle">connectcosts[][]</span>array as required. To change the
number of nodes, you should modify the value assigned to
<span class="CodeStyle">NUM_NODES</span> in the
constructor of the <span class="CodeStyle">RouterSimulator </span>class.</p>

<table  class="FigureTable">
	<tr>
		<td>
		<a name="init">
		<img src="images/init.png" /></a></td>
	</tr>
	<tr>
		<td class="FigureCap"><strong>Figure 3:</strong>
		A sample code showing initialization of link costs in the RouterSimulator4 network topology in
		<a href="#Fig1" target="_self">Figure 1</a>
		</td>
	</tr>
</table>


<p>The simulator will never send <b>RouterPacket</b> messages itself. It is
your code which must ensure that the information is exchanged between routers
in the network.</p>

<p>
The <strong>RouterNode</strong> file has a variable called
<span class="CodeStyle">costs</span> which is initialized in the constructor.
The simulator sets the link costs associated with a node through the
<span class="CodeStyle">costs</span> variable. For example, in the second
network shown in <a href="#Fig1" target="_self">Figure 1</a>, the link costs
for node 1 is set via the vector
<span class="CodeStyle">{1, 0, 1, RouterSimulator.INFINITY} </span>, which
means that the cost of the link (from Node 1)
to node 0 is <span class="CodeStyle">1</span>,
to itself is <span class="CodeStyle">0</span>,
to node 2 is <span class="CodeStyle">1</span>,
and to node 3 is <span class="CodeStyle">INFINITY</span>.
</p>

<p>
Costs for all links are set in the constructor for the
<span class="CodeStyle">RouterSimulator</span> class as was discussed for
<a href="#init" target="_self">Figure 3</a>. Further down in that code, two
events are added which change the link costs at specific times during the
simulation period.

The link between <span class="CodeStyle">eventity</span> and
<span class="CodeStyle">dest</span> changes to
<span class="CodeStyle">cost</span> at time
<span class="CodeStyle">evtime</span>. A sample code for adding such a cost
changing event is shown in <a href="#event" target="_self">Figure 4</a>.
Note that the link costs will not change if you use
<span class="CodeStyle">-DChange=false</span> (Java) or
<span class="CodeStyle">-c false</span> (Python) to disable the change. You can
change link costs and the events to test your code. When a link cost change
(which is scheduled by using the above-mentioned events) happens, the simulator
notifies the router nodes by calling the
<span class="CodeStyle">updateLinkCost()</span> method, which you should
implement.</p>

<table  class="FigureTable">
	<tr>
		<td>
		<a name="event">
		<img src="images/event.png" /></a></td>
	</tr>
	<tr>
		<td class="FigureCap"><strong>Figure 4:</strong>
		A sample code showing insertion of an event that changes the link cost between Node 0 and Node 1 to 60 at simulation time 40
		</td>
	</tr>
</table>

<p>Each of the three copies of the simulator (for the networks illustrated in
<a href="#Fig1" target="_self">Figure 1</a>)
have at least one link cost changing event scheduled. The following figures show
how in each of the topologies link costs change:</p>


<table  class="FigureTable">
	<tr>
		<td valign="middle"><img src="images/3_node_lc.png" style="width:90%;text-align:center" /></td>
		<td valign="middle"><img src="images/4_node_lc.png" style="width:90%;text-align:center" /></td>
		<td valign="middle"><img src="images/5_node_lc.png" style="width:90%;text-align:center" /></td>
	</tr>
	<tr>
		<td colspan="3" class="FigureCap"><strong>Figure 5:</strong>
		Change of link costs
		</td>
	</tr>
</table>


<p>
More information about implementation of distance vector routing can be found in RFCs, such as the following :</p>
<ul>
	<li><a href="http://www.ietf.org/rfc/rfc1058.txt">C. Hedrick, C. (1988), RFC 1058 Routing information protocol. IETF, June 1988.</a></li>
</ul>
as well as in many other online resources, books, and publications.

<p>&nbsp;</p>
<hr noshade="noshade" size="1" width="33%" />
<br />
<p class="SectionTitles"><a name="Development_Strategy">Development Strategy</a></p>
<p>As a general remark, it is suggested that you take a step-by-step approach for
this assignment, such that initially the constructor, the recvUpdate() method,
and the printDistanceTable() method are implemented and tested with link cost
changes and poison reverse turned off (see instructions for this above). In the
second step, updateLinkCost() should be implemented and tested with link cost
changes enabled. Start with 3 nodes, where a link cost change is configured
to happen at simulation time 40. At this point you will observe the
count-to-infinity problem. After this, you may try with 4 and 5 nodes as well
and examine the results. In the third step, Poisoned Reverse should be
implemented to address the count-to-infinity problem. Your implementation
should be such that &quot;poisoning&quot; can be easily enabled and disabled
with the command line instructions (i.e. using
<span class="CodeStyle">-DPoison=false</span> (Java) or
<span class="CodeStyle">-p false</span> (Python)).</p>

<p><strong>Remember:</strong> You should <em>only</em> modify and hand in the
<span class="CodeStyle">RouterNode</span> file. The other files can be
modified for testing purposes, but should <em>not</em> be submitted.</p>

<p>&nbsp;</p>
<hr noshade="noshade" size="1" width="33%" />
<br />
<p class="SectionTitles"><a name="Supplementary_Questions_on_the_Labs">Beyond Poisoned Reverse</a></p>

<p>The &quot;Poisoned Reverse&quot; technique solves the problem with the loops
in the network topologies that you test in this lab. Give an example of a
topology (e.g. an extension of one of networks in this lab) where the algorithm
would not work, and explain the reason. Give a solution for this new problem
and explain how the problem is resolved by your solution. Even if using
solutions proposed in the literature, please use your own words and clearly
explain the above issues and solutions.
</p>

<p>&nbsp;</p>
<hr noshade="noshade" size="1" width="33%" />
<br />
<p class="SectionTitles"><a name="Reporting"></a>Demonstration and Reporting</p>
<p>
To complete this lab you should demonstrate your solution to the TA.

Your TA might use topologies other than the predefined to test your code. Be
ready to explain what the <span class="CodeStyle">printDistanceTable()</span>
displays on the screen, and how you have implemented the Poisoned Reverse
algorithm.</p>

<p>
You should also write a short report in which you carefully describe and discuss
(i) how distance vector routing works,
(ii) how you tested the algorithms,
(iii) some cases in which poisoned reverse may fail, and
(iv) a solution to this problem.
Make sure you have responded in detail to the questions above
(particularly to those related to bullets (iii) and (iv))
and use valid sources as references.</p>
<p>
After your demonstration, you should email your report as well as the
RouterNode file to your TA.</p>
</div>
</body>

</html>
